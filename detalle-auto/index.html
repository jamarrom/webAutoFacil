<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;700;900&family=Lato:wght@400;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="../css/reset.css" />
  <link rel="stylesheet" href="../css/globalDetalle.css" />
  <link rel="stylesheet" href="../css/detalle.css" />
  <title>Detalle del Vehículo - AutoFácil</title>
  <link rel="icon" type="image/png" href="../favicon.png">
  <style>
    .loading { text-align:center; padding:4rem; color:#666; font-size:1.5rem; }
    .main-image { 
      width:100%; 
      height:500px; 
      object-fit:cover; 
      border-radius:12px; 
      display: block;
    }
    .main-video {
      width: 100%;
      height: 500px;
      border-radius: 12px;
      object-fit: cover;
      display: block;
    }
    .thumbnail { 
      width:100%; 
      height:100px; 
      object-fit:cover; 
      cursor:pointer; 
      border:3px solid transparent; 
      border-radius:8px; 
      transition:all .3s; 
    }
    .thumbnail.active { 
      border-color:#dc2626; 
      transform:scale(1.05); 
    }
    /* Estilo para thumbnails de video */
    .video-thumb {
      position: relative;
    }
    .video-thumb::after {
      content: '▶';
      position: absolute;
      top: 5px;
      right: 5px;
      background: rgba(0,0,0,0.7);
      color: white;
      padding: 3px 8px;
      border-radius: 50%;
      font-size: 12px;
    }
    /* Controles de video */
    .video-controls-overlay {
      position: absolute;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      display: flex;
      gap: 15px;
      z-index: 10;
    }
    .video-control-btn {
      background: rgba(0,0,0,0.7);
      color: white;
      border: none;
      padding: 10px 15px;
      border-radius: 25px;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 5px;
      font-size: 14px;
    }
    .video-control-btn:hover {
      background: rgba(0,0,0,0.9);
    }
  </style>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css">
</head>
<body>
	<header class="app-header">
		<div class="header-container">
			<h1 class="header-logo"><span>AutoFácil - Crédito Inmediato</span></h1>

      <!-- BOTÓN HAMBURGUESA -->
    <button class="hamburger" aria-label="Menú" id="hamburger">
      <i class="fas fa-bars"></i>
    </button>

			<nav class="header-nav"" id="main-nav">
        <ul class="nav-list">
          <li><a href="../" class="nav-link">Inicio</a></li>
          <li><a href="../todos-los-autos" class="nav-link">Catálogo</a></li>
          <li><a href="../remates" class="nav-link">Remates</a></li>
          <li><a href="../nosotros" class="nav-link">Nosotros</a></li>
          <li><a href="../contacto" class="nav-link">Contacto</a></li>
        </ul>
			</nav>
			<div class="header-right">
			<div class="social-icons">
				<a href="#"><img src="../img/icons/facebook.svg" alt=""></a>
				<a href="#"><img src="../img/icons/instagram.svg" alt=""></a>
			</div>
			<a href="../contacto" class="btn-demo hover-bright" style="background-color: #dc2626; padding: 10px 11px;">Agendar Demo</a>
			</div>
		</div>
		</header>
	
		<div class="group">
			<div class="app">
				<div class="app-vehicle-detail">
					<div class="app-container1">
						<object data="../assets/app-icon1.svg" class="app-icon1"></object>
						<p class="app-text-volver-a-todos" onclick="window.history.back()" style="cursor:pointer;">Volver a Todos los Autos</p>
					</div>

					<div class="app-container2">
						<div class="app-container3">
						<!-- IMÁGENES Y VIDEOS -->
							<div class="card1" id="car-detail">
								<div class="loading">Cargando vehículo...</div>
							</div>

							<!-- DESCRIPCIÓN, ESPECIFICACIONES Y CARACTERÍSTICAS SE CARGARÁN AQUÍ -->
							<div id="car-info"></div>
						</div>

            <div class="card6" id="car-sidebar">
              <!-- El contenido del sidebar se cargará dinámicamente -->
            </div>
					</div>
			</div>
			
			<div class="app-footer">
				<div class="footer-main">
					<!-- Columna 1: Logo y descripción -->
					<div class="footer-brand">
						<img src="../img/logoFooter.png" class="footer-logo" alt="AutoFácil Logo" />
						<p class="footer-description">
							Tu socio confiable para vehículos premium. Calidad, confiabilidad y servicio excepcional.
						</p>
						<!-- ICONOS DE REDES SOCIALES -->
						<div class="footer-social">
							<a href="https://facebook.com/autofacil" target="_blank" class="social-link" aria-label="Síguenos en Facebook">
							<img src="../img/icons/facebook.svg" alt="Facebook" class="social-icon" />
							</a>
							<a href="https://instagram.com/autofacil" target="_blank" class="social-link" aria-label="Síguenos en Instagram">
							<img src="../img/icons/instagram.svg" alt="Instagram" class="social-icon" />
							</a>
							<a href="https://twitter.com/autofacil" target="_blank" class="social-link" aria-label="Síguenos en Twitter">
							<img src="../img/icons/twitter.svg" alt="Twitter" class="social-icon" />
							</a>
						</div>
					</div>
						<!-- Columna 2: Enlaces Rápidos -->
					<div class="footer-column">
						<h3 class="footer-heading">Enlaces Rápidos</h3>
						<ul class="footer-list">
							<li><a href="../">Inicio</a></li>
							<li><a href="/todos-los-autos">Catálogo</a></li>
							<li><a href="#">Nosotros</a></li>
							<li><a href="/contacto">Contacto</a></li>
						</ul>
					</div>
						<!-- Columna 3: Servicios -->
					<div class="footer-column">
						<h3 class="footer-heading">Servicios</h3>
						<ul class="footer-list">
							
							<li><a href="/vende-tu-auto">Vender tu Auto</a></li>
							<li><a href="/terminos-y-condiciones/">Términos y Condiciones</a></li>
							<li><a href="/aviso-de-privacidad">Aviso de Privacidad</a></li>
						</ul>
					</div>
						<!-- Columna 4: Contáctanos -->
					<div class="footer-column">
						<h3 class="footer-heading">Contáctanos</h3>
						<ul class="footer-contact">
							<li>
                  <object data="../assets/app-icon.svg" type="image/svg+xml"></object>
                  <span><a href="https://www.google.com/maps/place/Auto+F%C3%A1cil/@17.9886663,-92.9302648,17z/data=!3m1!4b1!4m6!3m5!1s0x85edd82fdf4fd289:0x183cefa580c5c577!8m2!3d17.9886612!4d-92.9276899!16s%2Fg%2F11b7llyv5k!5m1!1e1?entry=ttu&g_ep=EgoyMDI1MTIwOS4wIKXMDSoASAFQAw%3D%3D" target="_blank">Paseo Tabasco esq. 27 de Febrero, Nueva Villahermosa, 86070.</a><br />
                  <a href="https://www.google.com/maps/place/Plaza+Paty/@17.9661531,-92.9544807,17z/data=!3m2!4b1!5s0x85edd76d7cefb4ad:0xcaa162cbfcfc69f!4m6!3m5!1s0x85edd76e0488ed35:0x37c710471df9edf0!8m2!3d17.966148!4d-92.9519058!16s%2Fg%2F12lt2zwx3!5m1!1e1?entry=ttu&g_ep=EgoyMDI1MTIwOS4wIKXMDSoASAFQAw%3D%3D" target="_blank">Periférico 1408, Tamulté de las Barrancas, 86150.<br />
                  Villahermosa, Tabasco.</span></a>
							</li>
							<li>
								<object data="../../assets/list-item/list-item-icon1.svg" type="image/svg+xml"></object>
								<span><a href="tel:+525512345678"></a>+52 (55) 1234-5678</a></span>
							</li>
							<li>
								<a href="mailto: info@autofacil.com.mx">
									<object data="../../assets/list-item/list-item-icon2.svg" type="image/svg+xml"></object>
									<span>info@autofacil.com.mx</span>
								</a>
							</li>
						</ul>
					</div>
				</div>
					<!-- Línea divisoria y copyright -->
				<div class="footer-bottom">
					<p class="footer-copyright">
						© 2025 AutoFácil - Crédito Inmediato. Todos los derechos reservados.
					</p>
					<div class="footer-links">
						<a href="#" class="footer-link">Política de Privacidad</a>
						<span class="footer-separator">•</span>
						<a href="/terminos-y-condiciones/" class="footer-link">Términos y Condiciones</a>
					</div>
				</div>
			</div>
		</div>
		
		
	</div>

	<script>
const API_URL = 'http://54.205.241.136/api/public/car/'
const urlParams = new URLSearchParams(window.location.search)
const carId = urlParams.get('id')

let images = []
let currentIndex = 0
let autoSlideInterval = null
let currentVideo = null

// DETECTAR TIPO DE MEDIO
function getMediaType(item) {
  if (item.mediaType === 'VIDEO') return 'video'
  if (item.url.includes('.mp4') || item.url.includes('.mov') || item.url.includes('.avi')) return 'video'
  return 'image'
}

// OBTENER THUMBNAIL PARA VIDEO
function getVideoThumbnail(item) {
  if (item.thumbnailUrl) return 'http://54.205.241.136' + item.thumbnailUrl
  return 'http://54.205.241.136' + item.url.replace('.mp4', '.jpg').replace('.mov', '.jpg')
}

// CAMBIAR MEDIO PRINCIPAL
function changeMainMedia(index) {
  if (images.length === 0) return
  currentIndex = index

  const item = images[index]
  const mediaType = getMediaType(item)
  
  // Obtener el contenedor principal
  const mainContainer = document.querySelector('.card-vehicle-detail1')
  if (!mainContainer) return
  
  // Limpiar el contenedor principal
  mainContainer.innerHTML = ''
  
  // Remover estilo background-image anterior
  mainContainer.style.backgroundImage = 'none'
  
  if (mediaType === 'video') {
    // Crear elemento de video
    const video = document.createElement('video')
    video.src = 'http://54.205.241.136' + item.url
    video.className = 'main-video'
    video.autoplay = true
    video.loop = true
    video.muted = true // Muteado para autoplay
    video.controls = false // No mostrar controles nativos
    video.playsInline = true
    
    // Añadir controles personalizados
    const controlsDiv = document.createElement('div')
    controlsDiv.className = 'video-controls-overlay'
    controlsDiv.innerHTML = `
      <button class="video-control-btn" onclick="togglePlayPause(this, event)">
        <i class="fas fa-pause"></i> Pausar
      </button>
      <button class="video-control-btn" onclick="toggleMute(this, event)">
        <i class="fas fa-volume-up"></i> Sonido
      </button>
    `
    
    // Añadir elementos al contenedor
    mainContainer.appendChild(video)
    mainContainer.appendChild(controlsDiv)
    
    // Guardar referencia al video actual
    currentVideo = video
    
    // Añadir botón destacado si es necesario
    if (document.querySelector('.card-btn-badge')) {
      mainContainer.appendChild(document.querySelector('.card-btn-badge'))
    }
    
  } else {
    // Usar imagen como background (como estaba originalmente)
    const imgUrl = 'http://54.205.241.136' + item.url
    mainContainer.style.backgroundImage = `url('${imgUrl}')`
    mainContainer.style.backgroundSize = 'cover'
    mainContainer.style.backgroundPosition = 'center'
    
    // Añadir botón destacado si es necesario
    if (document.querySelector('.card-btn-badge')) {
      mainContainer.appendChild(document.querySelector('.card-btn-badge'))
    }
  }

  // Actualizar thumbnails (mantener diseño original)
  document.querySelectorAll('.thumbnail').forEach((thumb, i) => {
    if (i === index) {
      thumb.style.border = '4px solid #dc2626'
      thumb.style.transform = 'scale(1.05)'
    } else {
      thumb.style.border = '2px solid #ddd'
      thumb.style.transform = 'scale(1)'
    }
  })
}

// Control de play/pause para videos
function togglePlayPause(button, e) {
  e.stopPropagation()
  if (currentVideo) {
    if (currentVideo.paused) {
      currentVideo.play()
      button.innerHTML = '<i class="fas fa-pause"></i> Pausar'
    } else {
      currentVideo.pause()
      button.innerHTML = '<i class="fas fa-play"></i> Reproducir'
    }
  }
}

// Control de mute para videos
function toggleMute(button, e) {
  e.stopPropagation()
  if (currentVideo) {
    currentVideo.muted = !currentVideo.muted
    button.innerHTML = currentVideo.muted 
      ? '<i class="fas fa-volume-mute"></i> Silenciado' 
      : '<i class="fas fa-volume-up"></i> Sonido'
  }
}

// SIGUIENTE
function nextMedia() {
  // Detener video actual si existe
  if (currentVideo) {
    currentVideo.pause()
    currentVideo = null
  }
  
  currentIndex = (currentIndex + 1) % images.length
  changeMainMedia(currentIndex)
}

// ANTERIOR
function prevMedia() {
  // Detener video actual si existe
  if (currentVideo) {
    currentVideo.pause()
    currentVideo = null
  }
  
  currentIndex = (currentIndex - 1 + images.length) % images.length
  changeMainMedia(currentIndex)
}

// AUTO SLIDE (solo para imágenes)
function startAutoSlide() {
  stopAutoSlide()
  autoSlideInterval = setInterval(() => {
    // Solo avanzar si el medio actual no es un video
    const currentItem = images[currentIndex]
    if (currentItem && getMediaType(currentItem) === 'image') {
      nextMedia()
    }
  }, 5000)
}

function stopAutoSlide() {
  if (autoSlideInterval) clearInterval(autoSlideInterval)
}

if (!carId) {
  document.body.innerHTML = '<h1 style="text-align:center;padding:10rem;color:#dc2626;">Falta el ID del vehículo</h1>'
} else {
  fetch(API_URL + carId)
    .then(res => res.ok ? res.json() : Promise.reject())
    .then(car => {
      images = Array.isArray(car.images) ? car.images : []
      if (images.length === 0) images = [{ url: '/img/placeholder.jpg', mediaType: 'IMAGE' }]

      const primaryImg = images.find(i => i.isPrimary)?.url || images[0].url
      const primaryItem = images.find(i => i.isPrimary) || images[0]
      const isVideoPrimary = getMediaType(primaryItem) === 'video'

      // === GALERÍA CON SLIDER AUTOMÁTICO Y BOTONES FUNCIONALES ===
      let galleryHTML = `
        <div class="card-vehicle-detail1" 
             style="${isVideoPrimary ? '' : `background-image:url('http://54.205.241.136${primaryImg}');`}
                    background-size:cover; background-position:center; 
                    height:520px; border-radius:16px; position:relative;
                    transition:background-image 0.6s ease-in-out;">
          ${car.isFeatured ? '<button class="card-btn-badge hover-bright">Destacado</button>' : ''}
        </div>

        <div class="card-vehicle-detail2" style="margin-top:20px; display:flex; gap:12px; overflow-x:auto; padding:10px 0;">
          ${images.map((img, i) => {
            const isVideo = getMediaType(img) === 'video'
            const thumbUrl = isVideo ? getVideoThumbnail(img) : 'http://54.205.241.136' + img.url
            
            return `
            <div style="position:relative;">
              <img src="${thumbUrl}" 
                   class="card-button card-btn${i+1} thumbnail ${isVideo ? 'video-thumb' : ''}"
                   style="width:120px; height:80px; object-fit:cover; border-radius:12px; cursor:pointer; 
                          border:${i===0?'4px solid #dc2626':'2px solid #ddd'}; 
                          transition:all 0.3s; flex-shrink:0;"
                   onclick="changeMainMedia(${i})"
                   onerror="this.src='../img/placeholder.jpg'">` +
                   (isVideo ? `


                   <div class="play-icon" 
                      style="position:absolute; top:50%; left:50%; transform:translate(-50%, -50%);
                              width:32px; height:32px; background:rgba(0,0,0,0.6); border-radius:50%;
                              display:flex; align-items:center; justify-content:center;">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" 
                        fill="white" width="20" height="20">
                      <path d="M8 5v14l11-7z"/>
                    </svg>
                  </div>` : '') + `
            </div>
            `
            
          }).join('')}
        </div>

        <div class="card-row-bottom">
            <div class="circle-button circle-btn1 hover-bright" onclick="prevMedia()" style="cursor:pointer;">
            </div>
            <div class="circle-button circle-btn2 hover-bright" onclick="nextMedia()" style="cursor:pointer;">
            </div>
          </div>
      `

      document.getElementById('car-detail').innerHTML = galleryHTML

      // Si el medio principal es video, cargarlo
      if (isVideoPrimary) {
        changeMainMedia(0)
      }

      // === DESCRIPCIÓN + ESPECIFICACIONES (diseño original) ===
      document.getElementById('car-info').innerHTML = `
        <div class="app-container4">
          <h2 class="app-subtitle1">Descripción</h2>
          <p class="app-text-paragraph1">${car.description || 'Vehículo en excelente estado, listo para entrega inmediata.'}</p>
        </div>

        <div class="card2">
          <h2 class="card-subtitle2 subtitle-black">Especificaciones</h2>
          <div class="card-vehicle-detail3">
            <div class="card-container">
              <div class="card-icon">
                <div class="card-line card-line1"></div>
                <div class="card-line card-line2"></div>
                <div class="card-group"><div class="card-line card-line3"></div></div>
              </div>
              <div class="container-a container2">
                <p class="container-text-paragraph1">Año</p>
                <p class="container-text-paragraph2">${car.year}</p>
              </div>
            </div>

            <div class="container-b container3">
              <object data="../assets/container/container-icon1.svg" class="container-icon1"></object>
              <div class="container-a container1">
                <p class="container-text-paragraph1">Kilometraje</p>
                <p class="container-text-paragraph2">${Number(car.mileage).toLocaleString()} km</p>
              </div>
            </div>

            <div class="container-b container4">
              <object data="../assets/container/container-icon.svg" class="container-icon1"></object>
              <div class="container-a container1">
                <p class="container-text-paragraph1">Tipo de Motor</p>
                <p class="container-text-paragraph2">${car.fuelType || 'Gasolina'}</p>
              </div>
            </div>

            <div class="container-b container5">
              <object data="../assets/container/container-icon3.svg" class="container-icon1"></object>
              <div class="container-a container1">
                <p class="container-text-paragraph1">Transmisión</p>
                <p class="container-text-paragraph2">${car.transmission || 'Automática'}</p>
              </div>
            </div>

            <div class="container-c container6">
              <object data="../assets/container/container-icon4.svg" class="container-icon2"></object>
              <div class="container-container">
                <p class="container-text-paragraph3">Color</p>
                <p class="container-text-paragraph4">${car.color || 'No especificado'}</p>
              </div>
            </div>

            <div class="container-b container7">
              <object data="../assets/container/container-icon5.svg" class="container-icon1"></object>
              <div class="container-a container1">
                <p class="container-text-paragraph1">Asientos</p>
                <p class="container-text-paragraph2">${car.seats || 5} pasajeros</p>
              </div>
            </div>

            ${car.horsepower ? `
            <div class="container-c container8">
              <object data="../assets/container/container-icon3.svg" class="container-icon2"></object>
              <div class="container-container">
                <p class="container-text-paragraph3">Caballos de Fuerza</p>
                <p class="container-text-paragraph4">${car.horsepower} HP</p>
              </div>
            </div>` : ''}

            ${car.fuelEconomy ? `
            <div class="container-c container9">
              <object data="../assets/container/container-icon.svg" class="container-icon2"></object>
              <div class="container-container">
                <p class="container-text-paragraph3">Economía de Combustible</p>
                <p class="container-text-paragraph4">${car.fuelEconomy}</p>
              </div>
            </div>` : ''}
          </div>
        </div>
      `

      // === SIDEBAR DERECHO (diseño original) ===
      document.getElementById('car-sidebar').innerHTML = `
        <div class="card-vehicle-detail4">
          <h2 class="card-subtitle3">${car.title}</h2>
          <p class="card-text-paragraph3">${car.year} • ${car.type || 'Sedán'}</p>
        </div>
        <div class="card-vehicle-detail5">
          <p class="card-text-paragraph4 text-blue">Precio</p>
          <h2 class="card-subtitle4">$${Number(car.price).toLocaleString()}</h2> 
        </div>
        <button class="card-btn4 hover-bright" onclick="location.href='../contacto/?id=${car.id}'" style="background-color: #dc2626; padding: 10px 11px;">Agendar Demo</button>
        <div class="card-vehicle-detail6">
          <p class="card-text-heading">Financiamiento Disponible</p>
          <p class="card-text-paragraph5 text-blue">
            Obtén aprobación de crédito instantánea con nuestras Términos y Condiciones flexibles. ¡Maneja hoy mismo!
          </p>
          <p class="card-text-btn text1">Más Información →</p>
        </div>
        <div class="card-vehicle-detail7">
          <div class="list-item container16"><object data="../assets/list-item/list-item-icon3.svg"></object><p class="list-item-text">Reporte de Historial Gratuito</p></div>
          <div class="list-item container17"><object data="../assets/list-item/list-item-icon3.svg"></object><p class="list-item-text">Garantía de Devolución de 7 Días</p></div>
          <div class="list-item container18"><object data="../assets/list-item/list-item-icon3.svg"></object><p class="list-item-text">Opciones Certificadas de Segunda Mano</p></div>
        </div>
      `

      // INICIAR SLIDER AUTOMÁTICO (solo para imágenes)
      startAutoSlide()

      // PAUSAR AL HACER HOVER EN LA GALERÍA
      const gallery = document.getElementById('car-detail')
      gallery.addEventListener('mouseenter', () => {
        stopAutoSlide()
        if (currentVideo) {
          currentVideo.pause()
        }
      })
      
      gallery.addEventListener('mouseleave', () => {
        startAutoSlide()
        if (currentVideo && currentVideo.paused) {
          currentVideo.play().catch(e => console.log('Autoplay bloqueado'))
        }
      })

    })
    .catch(err => {
      console.error('Error:', err)
      document.getElementById('car-detail').innerHTML = '<p style="color:#dc2626;text-align:center;padding:6rem;font-size:1.8rem;">Vehículo no encontrado</p>'
    })
}
</script>

<script>
  // === MENÚ HAMBURGUESA FULL-SCREEN ===
  const hamburger = document.getElementById('hamburger');
  const nav = document.getElementById('main-nav');
  const body = document.body;

  // Crear overlay si no existe
  let overlay = document.querySelector('.menu-overlay');
  if (!overlay) {
    overlay = document.createElement('div');
    overlay.className = 'menu-overlay';
    body.appendChild(overlay);
  }

  hamburger.addEventListener('click', () => {
    nav.classList.toggle('open');
    body.classList.toggle('menu-open');
    hamburger.querySelector('i').classList.toggle('fa-bars');
    hamburger.querySelector('i').classList.toggle('fa-xmark');
  });

  overlay.addEventListener('click', () => {
    nav.classList.remove('open');
    body.classList.remove('menu-open');
    hamburger.querySelector('i').classList.replace('fa-xmark', 'fa-bars');
  });

  document.querySelectorAll('.nav-link').forEach(link => {
    link.addEventListener('click', () => {
      nav.classList.remove('open');
      body.classList.remove('menu-open');
      hamburger.querySelector('i').classList.replace('fa-xmark', 'fa-bars');
    });
  });
</script>
</body>
</html>